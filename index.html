<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador em lote ITF-14</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <style>
        .barcode-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .barcode-wrapper {
            text-align: center;
        }
        .barcode {
            width: 100%;
            height: 100px;
        }
        .barcode-number {
            margin-top: -5px;
            font-size: 20px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div>
        <label for="file-input">Upload a .txt file with 12-digit numbers (one per line):</label>
        <input type="file" id="file-input" accept=".txt" />
    </div>
    <div id="barcode-container" class="barcode-container"></div>

    <script>
        console.log("JavaScript Loaded");

        if (typeof JsBarcode === 'undefined') {
            console.error("JsBarcode is not loaded!");
        } else {
            console.log("JsBarcode is loaded successfully");
        }

        function convertToITF14(input) {
            console.log("Converting to ITF-14:", input);
            const withLeadingZero = "0" + input;
            let sum = 0;
            for (let i = 0; i < withLeadingZero.length; i++) {
                const digit = parseInt(withLeadingZero[i], 10);
                sum += (i % 2 === 0) ? digit * 3 : digit;
            }
            const checksum = (10 - (sum % 10)) % 10;
            const itf14 = withLeadingZero + checksum;
            console.log("Converted ITF-14:", itf14);
            return itf14;
        }

        function createBarcodeElement(input, id) {
            console.log("Creating barcode for:", input);
            const wrapper = document.createElement("div");
            wrapper.className = "barcode-wrapper";

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("id", id);
            svg.classList.add("barcode");

            wrapper.appendChild(svg);

            const number = document.createElement("div");
            number.textContent = input;
            number.className = "barcode-number";

            wrapper.appendChild(number);

            return wrapper;
        }

        document.getElementById("file-input").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const lines = e.target.result.split(/\r?\n/).map(line => line.trim()).filter(line => line.length === 12);
                console.log("File lines:", lines);
                const container = document.getElementById("barcode-container");
                container.innerHTML = "";

                lines.forEach((line, index) => {
                    const id = `barcode-${index}`;
                    const barcodeElement = createBarcodeElement(line, id);
                    container.appendChild(barcodeElement);
                    
                    // Initialize the JsBarcode for each SVG after it is added to the DOM
                    JsBarcode(`#${id}`, convertToITF14(line), {
                        format: "ITF14",
                        lineColor: "#000",
                        width: 2,
                        height: 100,
                        margin: 10,
                        displayValue: false
                    });
                });
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html> 
